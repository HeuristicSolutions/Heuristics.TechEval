@model List<Heuristics.TechEval.Core.Models.Member>

@{
	ViewBag.Title = "Members";
}

<h1>
	Member List
	<button type="button" class="btn btn-primary pull-right" data-toggle="modal" onclick="editMember(0); return false;">Add Member</button>
</h1>

<div id="MembersList">
	@Html.Partial("_List", Model)
</div>

<div class="modal fade" id="EditMemberModal">
	<div id="memberModalContent"></div>
</div>

<script type="text/javascript">
	const editMember = (id) => {
		const options = { "backdrop": "static", keyboard: true };
		$.ajax({
			type: "GET",
			url: "/Members/Details",
			contentType: "application/json; charset=utf-8",
			data: { "Id": id },
			datatype: "json",
			success: function (data, status, jqXhr) {
				$("#memberModalContent").html(data);
				$("#EditMemberModal").modal(options);
				$("#EditMemberModal").modal("show");
				attachFormHandler();
			},
			error: function (jqXhr, status, err) {
				alert("Failed to load details: " + err);
			}
		});
	}

	const attachFormHandler = () => {
		$("#EditMemberForm").ajaxForm({
			success: function (data, status, jqXhr) {
				$("#MembersList").html(data);
				$("#EditMemberModal").modal("hide");
				alert("Saved successfully!"); // a toast would be better, just tell the user we actually did something
			},
			error: function (err) {
				alert("Failed to save member: " + err);
			}
		});
	}
</script>