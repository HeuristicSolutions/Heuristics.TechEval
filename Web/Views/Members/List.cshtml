@model Heuristics.TechEval.Web.ViewModels.MembersViewModel
@using Heuristics.TechEval.Web.Models
@{
    ViewBag.Title = "Members";
}

<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<style>
    .btn-container {
        margin-bottom: 10px;
    }
    .newly-added-row td:first-child {        
        font-weight: 600;
    }
    .newly-added-row td {
        vertical-align: middle !important;
    }
</style>

<h1>Member List</h1>
<div class="text-right btn-container">
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#NewMemberModal">Add Member</button>
</div>
<table class="table table-striped table-bordered table-hover" id="memberTable">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Category</th>
            <th scope="col">Actions</th>
        </tr>
    </thead>
    <tbody id="tableBody">
        @foreach (var member in Model.Members)
        {
            <tr id="@member.Id">
                <th id="@member.Id" style="vertical-align: revert" scope="row">@member.Id</th>
                <td id="name-@member.Id" style="vertical-align: revert">@member.Name</td>
                <td id="email-@member.Id" style="vertical-align: revert">@member.Email</td>
                <td id="categoryName-@member.Id" style="vertical-align: revert">@member.Category.Name</td>
                <td><button type="button" class="btn btn-link" id="editBtn-@member.Id" data-categoryid="@member.CategoryId" data-id="@member.Id" data-name="@member.Name" data-email="@member.Email" data-toggle="modal" data-target="#EditMemberModal">Edit</button></td>
            </tr>
        }
    </tbody>
</table>

<div class="modal fade" id="NewMemberModal">
    <div class="modal-dialog" role="document">
        @Html.Partial("_NewMember", Model)
    </div>
</div>

<div class="modal fade" id="EditMemberModal">
    <div class="modal-dialog" role="document">
        @Html.Partial("_EditMember", Model)
    </div>
</div>

<script type="text/javascript">
    $('#EditMemberModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        var name = button.data('name') // Extract info from data-* attributes
        var email = button.data('email')
        var id = button.data('id')
        var categoryId = button.data('categoryid')

        // Update the modal's content.
        var modal = $(this)
        modal.find('#editMemberFormName').val(name)
        modal.find('#editMemberFormEmail').val(email)
        modal.find('#editMemberFormId').val(id)
        modal.find('#editMemberFormCategoryId').val(categoryId)
    })

    $(document).ready(function () {
        $('#memberTable').DataTable({
            rowId: 'Id',
            columns: [
                { data: 'Id' },
                { data: 'Name' },
                { data: 'Email' },
                { data: 'Category' },
                { data: 'Actions' },
            ],
            columnDefs: [
                {
                    targets: [4],
                    orderable: false
                },
            ]
        });
    });
</script>
